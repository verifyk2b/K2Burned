<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Burn Wallet Live</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; line-height: 1.35; }
    .card { max-width: 860px; border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
    .row { display: flex; flex-wrap: wrap; gap: 14px; margin-top: 12px; }
    .kpi { flex: 1 1 220px; border: 1px solid #eee; border-radius: 12px; padding: 12px; }
    .label { font-size: 12px; color: #555; }
    .value { font-size: 20px; font-weight: 700; margin-top: 6px; word-break: break-all; }
    .muted { color: #666; font-size: 12px; }
    .warn { color: #8a4b00; }
    a { color: inherit; }
    code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="card">
    <h2 style="margin:0 0 6px 0;">Burn Wallet Live</h2>
    <div class="muted">
      Read-only dashboard. Polling-based updates. No wallet connect. No admin controls.
    </div>

    <div class="row">
      <div class="kpi">
        <div class="label">Burn wallet</div>
        <div class="value" id="burnWallet">—</div>
        <div class="muted"><a id="walletLink" target="_blank" rel="noreferrer">View on Solscan</a></div>
      </div>
      <div class="kpi">
        <div class="label">Token mint</div>
        <div class="value" id="tokenMint">—</div>
        <div class="muted"><a id="mintLink" target="_blank" rel="noreferrer">View mint on Solscan</a></div>
      </div>
      <div class="kpi">
        <div class="label">Balance in burn wallet</div>
        <div class="value" id="balance">—</div>
        <div class="muted">Last updated: <span id="updated">—</span></div>
      </div>
    </div>

    <div style="margin-top:14px" class="muted">
      Status: <span id="status">Initializing…</span>
      <span id="rateNote" class="warn"></span>
    </div>

    <hr style="border:none;border-top:1px solid #eee;margin:14px 0;">

    <div class="muted">
      Config:
      <div>Data: <code id="rpc">—</code></div>
      <div>Refresh: <code id="refresh">—</code></div>
    </div>
  </div>

<script>
/**
 * === CONFIG ===
 * Mint: K2B
 * Burn wallet: Solana Incinerator
 */
const BURN_WALLET = "1nc1nerator11111111111111111111111111111111";
const TOKEN_MINT  = "At4L287tND4vLSURFeVz2fqhbvNgnE76nfFg7gy9pump";
const POLL_MS     = 20000; // 20s
const EXPLORER_BASE = "https://solscan.io";

/**
 * If anything breaks, show the error on the page (mobile-friendly).
 */
window.addEventListener("error", (e) => {
  const status = document.getElementById("status");
  if (status) status.textContent = `JS Error: ${e.message}`;
});

/**
 * Browser-safe fetch via CORS proxy -> Solscan public API.
 */
async function fetchBurnBalance() {
  const targetUrl = `https://public-api.solscan.io/account/tokens?account=${BURN_WALLET}`;
  const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(targetUrl)}`;

  const res = await fetch(proxyUrl);
  if (!res.ok) throw new Error(`HTTP ${res.status}`);

  const data = await res.json();

  let totalUi = 0;
  let accountsCount = 0;

  for (const t of data) {
    if (t && t.tokenAddress === TOKEN_MINT) {
      totalUi += Number(t.tokenAmount?.uiAmount || 0);
      accountsCount++;
    }
  }

  return { totalUi, accountsCount };
}

function fmt(n) {
  if (n === 0) return "0";
  if (n >= 1000) return n.toLocaleString(undefined, { maximumFractionDigits: 2 });
  if (n >= 1) return n.toLocaleString(undefined, { maximumFractionDigits: 4 });
  return n.toLocaleString(undefined, { maximumFractionDigits: 8 });
}

function setText(id, v) { document.getElementById(id).textContent = v; }

async function tick() {
  const status = document.getElementById("status");
  const rateNote = document.getElementById("rateNote");
  try {
    status.textContent = "Fetching…";
    rateNote.textContent = "";

    const { totalUi, accountsCount } = await fetchBurnBalance();

    setText("balance", fmt(totalUi));
    setText("updated", new Date().toLocaleString());
    status.textContent = `OK (token entries: ${accountsCount})`;
  } catch (e) {
    status.textContent = `Error: ${e.message}`;
  }
}

(function init(){
  setText("burnWallet", BURN_WALLET);
  setText("tokenMint", TOKEN_MINT);
  document.getElementById("walletLink").href = `${EXPLORER_BASE}/account/${BURN_WALLET}`;
  document.getElementById("mintLink").href = `${EXPLORER_BASE}/token/${TOKEN_MINT}`;
  setText("rpc", "Solscan API (via AllOrigins)");
  setText("refresh", `${Math.round(POLL_MS/1000)}s`);

  tick();
  setInterval(tick, POLL_MS);
})();
</script>
</body>
</html>
